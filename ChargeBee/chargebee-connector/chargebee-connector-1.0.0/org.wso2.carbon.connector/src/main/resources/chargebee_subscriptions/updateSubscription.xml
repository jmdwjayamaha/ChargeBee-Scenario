<?xml version="1.0" encoding="UTF-8"?>
<!--
   Copyright (c) 2005-2015, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.

   WSO2 Inc. licenses this file to you under the Apache License,
   Version 2.0 (the "License"); you may not use this file except
   in compliance with the License.
   You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing,
   software distributed under the License is distributed on an
   "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
   KIND, either express or implied. See the License for the
   specific language governing permissions and limitations
   under the License.
-->
<!-- API Doc: https://apidocs.chargebee.com/docs/api/subscriptions#update_a_subscription -->
<template name="updateSubscription" xmlns="http://ws.apache.org/ns/synapse">
   <parameter name="subscriptionId" description="The unique identifier of the subscription." />
   <parameter name="planId" description="The unique identifier of the plan." />
   <parameter name="planQuantity" description="The quantity of plans to be subscribed." />
   <parameter name="startDate" description="The start date in UTC timestamp." />
   <parameter name="trialEndDate" description="The end date of trial subscription in UTC timestamp." />
   <parameter name="billingCycles" description="The number of billing cycles the subscription should be charged." />
   <parameter name="isReplaceAddonList" description="The boolean flag to change the existing addon list." />
   <parameter name="couponId" description="The unique identifier of a coupon." />
   <parameter name="isProrated" description="The boolean flag indicating prorated credit and charges." />
   <parameter name="isEndOfTerm" description="The boolean flag indicating the changes applied in the end of the term." />
   <parameter name="invoiceNotes" description="The notes for the invoice." />
   <parameter name="cardGateway" description="The name of the gateway for the card." />
   <parameter name="cardTmpToken" description="The single use card token." />
   <parameter name="cardFirstName" description="The cardFirstName" />
   <parameter name="cardLastName" description="The cardLastName" />
   <parameter name="cardNumber" description="The cardNumber" />
   <parameter name="cardExpiryMonth" description="The cardExpiryMonth" />
   <parameter name="cardExpiryYear" description="The cardExpiryYear" />
   <parameter name="cardCVV" description="The cardCVV" />
   <parameter name="cardBillingAddress1" description="The cardBillingAddress1" />
   <parameter name="cardBillingAddress2" description="The cardBillingAddress2" />
   <parameter name="cardBillingCity" description="The cardBillingCity" />
   <parameter name="cardBillingStateCode" description="The cardBillingStateCode" />
   <parameter name="cardBillingState" description="The cardBillingState" />
   <parameter name="cardBillingZip" description="The cardBillingZip" />
   <parameter name="cardBillingCountry" description="The cardBillingCountry" />
   <parameter name="cardIpAddress" description="The cardIpAddress" />
   <parameter name="billingAddressFirstName" description="The billingAddressFirstName" />
   <parameter name="billingAddressLastName" description="The billingAddressLastName" />
   <parameter name="billingAddressEmail" description="The billingAddressEmail" />
   <parameter name="billingAddressCompanyName" description="The billingAddressCompanyName" />
   <parameter name="billingAddressPhoneNumber" description="The billingAddressPhoneNumber" />
   <parameter name="billingAddressLine1" description="The billingAddressLine1" />
   <parameter name="billingAddressLine2" description="The billingAddressLine2" />
   <parameter name="billingAddressLine3" description="The billingAddressLine3" />
   <parameter name="billingAddressCity" description="The billingAddressCity" />
   <parameter name="billingAddressStateCode" description="The billingAddressStateCode" />
   <parameter name="billingAddressState" description="The billingAddressState" />
   <parameter name="billingAddressZip" description="The billingAddressZip" />
   <parameter name="billingAddressCountry" description="The billingAddressCountry" />
   <parameter name="shippingAddressFirstName" description="The shippingAddressFirstName" />
   <parameter name="shippingAddressLastName" description="The shippingAddressLastName" />
   <parameter name="shippingAddressEmail" description="The shippingAddressEmail" />
   <parameter name="shippingAddressCompanyName" description="The shippingAddressCompanyName" />
   <parameter name="shippingAddressPhoneNumber" description="The shippingAddressPhoneNumber" />
   <parameter name="shippingAddressLine1" description="The shippingAddressLine1" />
   <parameter name="shippingAddressLine2" description="The shippingAddressLine2" />
   <parameter name="shippingAddressLine3" description="The shippingAddressLine3" />
   <parameter name="shippingAddressCity" description="The shippingAddressCity" />
   <parameter name="shippingAddressStateCode" description="The shippingAddressStateCode" />
   <parameter name="shippingAddressState" description="The shippingAddressState" />
   <parameter name="shippingAddressZip" description="The shippingAddressZip" />
   <parameter name="shippingAddressCountry" description="The shippingAddressCountry" />
   <parameter name="customerVatNumber" description="The customerVatNumber" />
   <parameter name="addonIds" description="The addonIds" />
   <parameter name="addonsQuantity" description="The addonsQuantity" />
   <sequence>
      <property expression="$func:subscriptionId" name="uri.var.subscriptionId" />
      <property expression="$func:planId" name="uri.var.planId" />
      <property expression="$func:planQuantity" name="uri.var.planQuantity" />
      <property expression="$func:startDate" name="uri.var.startDate" />
      <property expression="$func:trialEndDate" name="uri.var.trialEndDate" />
      <property expression="$func:billingCycles" name="uri.var.billingCycles" />
      <property expression="$func:isReplaceAddonList" name="uri.var.isReplaceAddonList" />
      <property expression="$func:couponId" name="uri.var.couponId" />
      <property expression="$func:isProrated" name="uri.var.isProrated" />
      <property expression="$func:isEndOfTerm" name="uri.var.isEndOfTerm" />
      <property expression="$func:invoiceNotes" name="uri.var.invoiceNotes" />
      <property expression="$func:cardGateway" name="uri.var.cardGateway" />
      <property expression="$func:cardTmpToken" name="uri.var.cardTmpToken" />
      <property expression="$func:cardFirstName" name="uri.var.cardFirstName" />
      <property expression="$func:cardLastName" name="uri.var.cardLastName" />
      <property expression="$func:cardNumber" name="uri.var.cardNumber" />
      <property expression="$func:cardExpiryMonth" name="uri.var.cardExpiryMonth" />
      <property expression="$func:cardExpiryYear" name="uri.var.cardExpiryYear" />
      <property expression="$func:cardCVV" name="uri.var.cardCVV" />
      <property expression="$func:cardBillingAddress1" name="uri.var.cardBillingAddress1" />
      <property expression="$func:cardBillingAddress2" name="uri.var.cardBillingAddress2" />
      <property expression="$func:cardBillingCity" name="uri.var.cardBillingCity" />
      <property expression="$func:cardBillingStateCode" name="uri.var.cardBillingStateCode" />
      <property expression="$func:cardBillingState" name="uri.var.cardBillingState" />
      <property expression="$func:cardBillingZip" name="uri.var.cardBillingZip" />
      <property expression="$func:cardBillingCountry" name="uri.var.cardBillingCountry" />
      <property expression="$func:cardIpAddress" name="uri.var.cardIpAddress" />
      <property expression="$func:billingAddressFirstName" name="uri.var.billingAddressFirstName" />
      <property expression="$func:billingAddressLastName" name="uri.var.billingAddressLastName" />
      <property expression="$func:billingAddressEmail" name="uri.var.billingAddressEmail" />
      <property expression="$func:billingAddressCompanyName" name="uri.var.billingAddressCompanyName" />
      <property expression="$func:billingAddressPhoneNumber" name="uri.var.billingAddressPhoneNumber" />
      <property expression="$func:billingAddressLine1" name="uri.var.billingAddressLine1" />
      <property expression="$func:billingAddressLine2" name="uri.var.billingAddressLine2" />
      <property expression="$func:billingAddressLine3" name="uri.var.billingAddressLine3" />
      <property expression="$func:billingAddressCity" name="uri.var.billingAddressCity" />
      <property expression="$func:billingAddressStateCode" name="uri.var.billingAddressStateCode" />
      <property expression="$func:billingAddressState" name="uri.var.billingAddressState" />
      <property expression="$func:billingAddressZip" name="uri.var.billingAddressZip" />
      <property expression="$func:billingAddressCountry" name="uri.var.billingAddressCountry" />
      <property expression="$func:shippingAddressFirstName" name="uri.var.shippingAddressFirstName" />
      <property expression="$func:shippingAddressLastName" name="uri.var.shippingAddressLastName" />
      <property expression="$func:shippingAddressEmail" name="uri.var.shippingAddressEmail" />
      <property expression="$func:shippingAddressCompanyName" name="uri.var.shippingAddressCompanyName" />
      <property expression="$func:shippingAddressPhoneNumber" name="uri.var.shippingAddressPhoneNumber" />
      <property expression="$func:shippingAddressLine1" name="uri.var.shippingAddressLine1" />
      <property expression="$func:shippingAddressLine2" name="uri.var.shippingAddressLine2" />
      <property expression="$func:shippingAddressLine3" name="uri.var.shippingAddressLine3" />
      <property expression="$func:shippingAddressCity" name="uri.var.shippingAddressCity" />
      <property expression="$func:shippingAddressStateCode" name="uri.var.shippingAddressStateCode" />
      <property expression="$func:shippingAddressState" name="uri.var.shippingAddressState" />
      <property expression="$func:shippingAddressZip" name="uri.var.shippingAddressZip" />
      <property expression="$func:shippingAddressCountry" name="uri.var.shippingAddressCountry" />
      <property expression="$func:customerVatNumber" name="uri.var.customerVatNumber" />
      <property expression="$func:addonIds" name="uri.var.addonIds" />
      <property expression="$func:addonsQuantity" name="uri.var.addonsQuantity" />
      <script language="js">
         <![CDATA[
            // Generate request payload with optional parameters
            var subscriptionId = mc.getProperty('uri.var.subscriptionId');
            var planQuantity = mc.getProperty('uri.var.planQuantity');
            var startDate = mc.getProperty('uri.var.startDate');
            var trialEndDate = mc.getProperty('uri.var.trialEndDate');
            var billingCycles = mc.getProperty('uri.var.billingCycles');
            var couponId = mc.getProperty('uri.var.couponId');
            var pONumber = mc.getProperty('uri.var.pONumber');
            var invoiceNotes = mc.getProperty('uri.var.invoiceNotes');
            var shippingAddressFirstName = mc.getProperty('uri.var.shippingAddressFirstName');
            var shippingAddressLastName = mc.getProperty('uri.var.shippingAddressLastName');
            var shippingAddressEmail = mc.getProperty('uri.var.shippingAddressEmail');
            var shippingAddressCompanyName = mc.getProperty('uri.var.shippingAddressCompanyName');
            var shippingAddressPhoneNumber = mc.getProperty('uri.var.shippingAddressPhoneNumber');
            var shippingAddressLine1 = mc.getProperty('uri.var.shippingAddressLine1');
            var shippingAddressLine2 = mc.getProperty('uri.var.shippingAddressLine2');
            var shippingAddressLine3 = mc.getProperty('uri.var.shippingAddressLine3');
            var shippingAddressCity = mc.getProperty('uri.var.shippingAddressCity');
            var shippingAddressStateCode = mc.getProperty('uri.var.shippingAddressStateCode');
            var shippingAddressState = mc.getProperty('uri.var.shippingAddressState');
            var shippingAddressZip = mc.getProperty('uri.var.shippingAddressZip');
            var shippingAddressCountry = mc.getProperty('uri.var.shippingAddressCountry');
            
            var payload = mc.getPayloadJSON();
            payload = new Object();
            if (subscriptionId != null && subscriptionId != "") {
               payload.id = subscriptionId;
            }
            if (planQuantity != null && planQuantity != "") {
               payload.plan_quantity = planQuantity;
            }
            if (startDate != null && startDate != "") {
               payload. start_date = startDate;
            }
            if (trialEndDate != null && trialEndDate != "") {
               payload.trial_end = trialEndDate;
            }
            if (billingCycles != null && billingCycles != "") {
               payload.billing_cycles = billingCycles;
            }
            if (couponId != null && couponId != "") {
               payload.coupon = couponId;
            }
            if (pONumber != null && pONumber != "") {
               payload.po_number = pONumber;
            }
            if (invoiceNotes != null && invoiceNotes != "") {
               payload.invoice_notes = invoiceNotes;
            }
            if (shippingAddressFirstName != null && shippingAddressFirstName != "") {
               payload.shipping_address[first_name] = shippingAddressFirstName;
            }
            if (shippingAddressLastName != null && shippingAddressLastName != "") {
               payload.shipping_address[last_name] = shippingAddressLastName;
            }
            if (shippingAddressEmail != null && shippingAddressEmail != "") {
               payload.shipping_address[email] = shippingAddressEmail;
            }
            if (shippingAddressCompanyName != null && shippingAddressCompanyName != "") {
               payload.shipping_address[company] = shippingAddressCompanyName;
            }
            if (shippingAddressPhoneNumber != null && shippingAddressPhoneNumber != "") {
               payload.shipping_address[phone] = shippingAddressPhoneNumber;
            }
            if (shippingAddressLine1 != null && shippingAddressLine1 != "") {
               payload.shipping_address[line1] = shippingAddressLine1;
            }
            if (shippingAddressLine2 != null && shippingAddressLine2 != "") {
               payload.shipping_address[line2] = shippingAddressLine2;
            }
            if (shippingAddressLine3 != null && shippingAddressLine3 != "") {
               payload.shipping_address[line3] = shippingAddressLine3;
            }
            if (shippingAddressCity != null && shippingAddressCity != "") {
               payload.shipping_address[city] = shippingAddressCity;
            }
            if (shippingAddressStateCode != null && shippingAddressStateCode != "") {
               payload.shipping_address[state_code] = shippingAddressStateCode;
            }
            if (shippingAddressState != null && shippingAddressState != "") {
               payload.shipping_address[state] = shippingAddressState;
            }
            if (shippingAddressZip != null && shippingAddressZip != "") {
               payload.shipping_address[zip] = shippingAddressZip;
            }
            if (shippingAddressCountry != null && shippingAddressCountry != "") {
               payload.shipping_address[country] = shippingAddressCountry;
            }
                        
            mc.setPayloadJSON(payload);
         ]]>
      </script>
      <property name="messageType" value="application/x-www-form-urlencoded" scope="axis2" />
      <call>
         <endpoint>
            <http method="post" uri-template="{uri.var.apiUrl}/subscriptions/{uri.var.subscriptionId}" />
         </endpoint>
      </call>
   </sequence>
</template>